# 1. Smart Contract Architecture

This document details the architectural design and code structure of the CrowdFUNding smart contracts. The system is built on Base Sepolia using Solidity and Foundry.

## Core Contracts

The architecture revolves around two primary contracts:

1.  **Campaign.sol**: Handles the core crowdfunding logic, donations, and token swaps.
2.  **Badge.sol**: Manages the gamification aspect through NFTs.

### 1. Campaign.sol

This contract is the heart of the CrowdFUNding platform. It allows users to create campaigns, accept donations in various currencies (auto-swapped to IDRX), and withdraw funds.

**Key Components:**

- **State Variables:**
  - `_campaigns`: A mapping storing `CampaignStruct` data (name, creator, balance, target, etc.) by ID.
  - `mockSwap`: Reference to the swap contract used for converting tokens.
  - `storageToken`: The address of the token held in the vault (IDRX).

- **Functions:**
  - `createCampaign`: Initializes a new campaign struct and increments the campaign ID.
  - `donate(uint256 campaignId)`: **Payable** function. Accepts ETH (Base native currency).
    - **Logic**: It instantly calls `mockSwap.swapETHForToken` to convert the incoming ETH into IDRX. The resulting IDRX is added to the campaign's balance.
  - `donate(uint256 campaignId, uint256 amount, address tokenIn)`: Accepts ERC20 tokens.
    - **Logic**:
      - If `tokenIn` is IDRX, it transfers directly to the contract.
      - If `tokenIn` is another token (e.g., USDC), it performs an approval and calls `mockSwap.swap` to convert it to IDRX before crediting the campaign.
  - `withdraw`: Allows the campaign owner to withdraw funds. **Safety**: Uses `ReentrancyGuard` and checks `OnlyOwner`. All withdrawals are processed in IDRX.

- **Security Features:**
  - `ReentrancyGuard`: Applied to `donate` and `withdraw` to prevent re-entrancy attacks.
  - `SafeERC20`: Used for all token transfers to ensure consistent behavior across different ERC20 implementations.

### 2. Badge.sol

This contract implements the "FUN" in CrowdFUNding by minting NFT badges for users.

**Key Components:**

- **Standard**: ERC721 (Non-Fungible Token).
- **Inheritance**: Inherits `ERC721` for token standard and `Ownable` for access control.
- **Functions:**
  - `mintBadge(address to, string name, string description)`:
    - **Restricted**: `onlyOwner` (The platform/backend or the Campaign contract if set as owner).
    - **Logic**: Mints a new sequential Token ID to the specified address and stores metadata (`BadgeInfo`) on-chain.
  - `getBadgeInfo(uint256 tokenId)`: Returns the name and description of a specific badge.

## Helper Contracts (Testnet/Dev)

- **MockSwap.sol**: Simulates a DEX Router. Provides functions like `swapETHForToken` and `swap` to mimic Uniswap behavior without needing a real liquidity pool during testing.
- **MockIDRX.sol / MockUSDC.sol**: Standard ERC20 tokens with infinite minting for testing purposes.
